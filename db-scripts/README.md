# Database Role Scripts

This directory contains SQL scripts for creating database users with appropriate permissions.

## Usage

These scripts should be executed by the master database user (admin) after the RDS instance is created.

### Manual Execution

1. Connect to the RDS instance using the master credentials from AWS Secrets Manager
2. Execute each script in order:
   ```sql
   source app_user.sql;
   source migration_user.sql;
   source admin_user.sql;
   ```

### Automated Execution

These scripts can be executed via:
- Terraform `null_resource` with `local-exec` provisioner
- AWS RDS Custom Parameter Groups
- CI/CD pipeline step
- Kubernetes Job

## Password Management

**IMPORTANT**: The passwords in these scripts are placeholders. Actual passwords are:
- Generated by Terraform using `random_password` resources
- Stored in AWS Secrets Manager
- Should be retrieved and used when executing these scripts

## User Roles

### app_user
- **Purpose**: Application runtime database access
- **Permissions**: SELECT, INSERT, UPDATE, DELETE
- **Restrictions**: No DDL permissions (CREATE, ALTER, DROP)
- **Used by**: Application containers

### migration_user
- **Purpose**: Database migrations (Alembic)
- **Permissions**: Full DDL permissions (CREATE, ALTER, DROP, INDEX)
- **Restrictions**: Limited to application database
- **Used by**: Migration jobs/containers

### admin_user
- **Purpose**: Emergency operations and administration
- **Permissions**: Full database access
- **Restrictions**: Should be restricted by security group/IP whitelist
- **Used by**: Database administrators (restricted access)

## Security Notes

1. All users should use strong passwords (managed by Secrets Manager)
2. admin_user access should be restricted via security groups
3. Consider using IAM database authentication for additional security
4. Enable audit logging for admin_user operations
5. Rotate passwords regularly using Secrets Manager rotation

